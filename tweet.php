<?php

	// ã˜ã‚ƒã‚“ã‘ã‚“ã®ãƒªãƒ—ãƒ©ã‚¤ç”¨

	// TwitterOAuthã®èª­ã¿è¾¼ã¿
	require ('twitteroauth/autoload.php');
	use Abraham\TwitterOAuth\TwitterOAuth;

	// è¨­å®šèª­ã¿è¾¼ã¿
	require (dirname(__FILE__).'/config.php');

	// è¨­å®š
	// å‹åˆ©ç¢ºç‡
	$percent = 10; // %(ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆ)

	// ãƒ„ã‚¤ãƒ¼ãƒˆã‚’ä½•å€‹å–å¾—ã™ã‚‹ã‹
	$count = 10; // ä»¶

	// ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚ã‚Œã°
	if (isset($OAUTH_TOKEN) and isset($OAUTH_TOKEN_SECRET)){

		// ãƒ˜ãƒƒãƒ€ã‚’è¨­å®š
		header('content-type: application/json; charset=utf-8');

		// æ—¥æ™‚é–¢é€£
		$timestamp = microtime(true); // ç¾åœ¨æ™‚åˆ»ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—

		// ä½•åˆ†å‰ã¾ã§ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚’å–å¾—ã™ã‚‹ã‹
		if (file_exists(dirname(__FILE__).'/'.$timefile)){
			// ç¾åœ¨ã®Unixæ™‚é–“ã‹ã‚‰å‰å›å®Ÿè¡Œã—ãŸUnixæ™‚é–“ã‚’å¼•ã
			$last_timestamp = file_get_contents(dirname(__FILE__).'/'.$timefile);
			$last = $timestamp - $last_timestamp; // ç§’
		} else {
			// 20ç§’å‰ã«å®Ÿè¡Œã—ãŸã¨ä»®å®š
			$last = 20; // ç§’
			$last_timestamp = $timestamp - $last;
		}

		// è¡¨ç¤º
		echo "\n";
		echo '  -------------------------------------------------------'."\n";
		echo '            ***** æœ¬ç”°ã¨ã˜ã‚ƒã‚“ã‘ã‚“Bot '.$version.' *****'."\n";
		echo '  -------------------------------------------------------'."\n\n";
		echo '    å®Ÿè¡Œæ™‚åˆ»       : '.date('Y-m-d H:i:s')."\n";
		echo '    å‰å›ã®å®Ÿè¡Œæ™‚åˆ» : '.date('Y-m-d H:i:s', $last_timestamp)."\n";
		echo '    å®Ÿè¡Œé–“éš”       : '.$last.' ç§’'."\n\n";
		echo '  -------------------------------------------------------'."\n\n";

		// Twitterã«æ¥ç¶š
		$connection = new TwitterOAuth($CONSUMER_KEY, $CONSUMER_SECRET, $OAUTH_TOKEN, $OAUTH_TOKEN_SECRET);

		// æ¯æ™‚0åˆ†ãƒ»30åˆ†ãªã‚‰è‡ªå‹•ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹
		$min = date('i');
		if ($min == '00' or $min == '30'){
			$followers = $connection->get('followers/ids', array('cursor' => -1)); // ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã‚’å–å¾—
			$friends = $connection->get('friends/ids', array('cursor' => -1)); // ãƒ•ã‚©ãƒ­ãƒ¼ä¸­
			echo '    è‡ªå‹•ãƒ•ã‚©ãƒ­ãƒã‚’é–‹å§‹ã—ã¾ã™ã€‚'."\n\n";
			foreach ($followers->ids as $i => $id) {
				if (empty($friends->ids) or !in_array($id, $friends->ids)) {
					$connection->post('friendships/create', array('user_id' => $id)); // ãƒ•ã‚©ãƒ­ãƒã™ã‚‹
					echo '    ãƒ•ã‚©ãƒ­ãƒã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ID: '.$id."\n";
				}
			}
			echo "\n";
			echo '    è‡ªå‹•ãƒ•ã‚©ãƒ­ãƒã‚’çµ‚äº†ã—ã¾ã™ã€‚'."\n\n";
			echo '  -------------------------------------------------------'."\n\n";
		}
		
		echo '    ãƒªãƒ—ãƒ©ã‚¤ã‚’å–å¾—ã—ã¾ã™ã€‚'."\n";

		// ãƒªãƒ—ãƒ©ã‚¤ã‚’å–å¾—
		$res = $connection->get('statuses/mentions_timeline', array('count' => $count));

		// å®Ÿè¡Œæ™‚é–“ã‚’è¨˜éŒ²ã™ã‚‹
		file_put_contents(dirname(__FILE__).'/'.$timefile, microtime(true));

		echo '    ç›´è¿‘'.(count($res)).'ä»¶ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚’å–å¾—ã—ã¾ã—ãŸã€‚'."\n\n";
		echo '    ãƒªãƒ—ãƒ©ã‚¤ã¸ã®è¿”ä¿¡ã‚’é–‹å§‹ã—ã¾ã™ã€‚'."\n\n";
		echo '  -------------------------------------------------------'."\n\n";

		// ãƒ„ã‚¤ãƒ¼ãƒˆã‚’å–ã‚Šå‡ºã™
		for ($i = 0; $i < count($res); $i++) {

			// ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æ•´å½¢&ä¿®æ­£
			$tweet_timestamp = strtotime($res[$i]->created_at); // ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿æ™‚åˆ»ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒæ‰‹ã«å…¥ã‚‹

			echo '    ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿æ—¥æ™‚: '.date('Y-m-d H:i:s', $tweet_timestamp).' ãƒ„ã‚¤ãƒ¼ãƒˆã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—: '.$tweet_timestamp."\n";
			echo '    ãƒ„ã‚¤ãƒ¼ãƒˆã®URL: https://twitter.com/i/status/'.$res[$i]->id."\n\n";

			// è‡ªåˆ†ã‹ã‚‰ã®ãƒªãƒ—ãƒ©ã‚¤ã§ã¯ãªã„ & ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿æ™‚åˆ»ãŒå‰å›ã®å®Ÿè¡Œæ™‚åˆ»ã‚ˆã‚Šã‚‚å¾Œãªã‚‰
			if ($res[$i]->user->screen_name !== $screen_name and $tweet_timestamp >= $last_timestamp){

				// #æœ¬ç”°å„ªã—ãã—ã¦
				if (strpos($res[$i]->text, '#æœ¬ç”°å„ªã—ãã—ã¦') !== false){
					$percent = 40;
				}
				// #æœ¬ç”°å¤§å¥½ã
				if (strpos($res[$i]->text, '#æœ¬ç”°å¤§å¥½ã') !== false){
					$percent = 70;
				}

				// å‹æ•—ã‚’æ±ºã‚ã‚‹
				$random = rand(1, 100); // 1ï½100ã®ä¹±æ•°ã‚’å–å¾—

				if ($random < $percent){ // 1ï½æŒ‡å®šç¢ºç‡ã®é–“ãªã‚‰
					$jyanken = 'YOU WIN';
				} else {
					$jyanken = 'YOU LOSE';
				}

				// å–å¾—ã—ãŸãƒ„ã‚¤ãƒ¼ãƒˆã« #æœ¬ç”°ã«ã‚°ãƒ¼ã§å‹ã¤ ãŒå«ã¾ã‚Œã¦ã„ãŸã‚‰
				if (strpos($res[$i]->text, 'ã‚°ãƒ¼') !== false){

					// å‹æ•—åˆ¤å®š
					switch($jyanken) {

						// è² ã‘ãŸå ´åˆ
						case 'YOU LOSE':

							echo '    #æœ¬ç”°ã«ã‚°ãƒ¼ã§å‹ã¤ï¼šæ®‹å¿µã€æœ¬ç”°åœ­ä½‘ã®å‹åˆ©ï¼'."\n\n";

							// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‹•ç”»
							$video = dirname(__FILE__).'/video/honda_lost_3.mp4';

							// ãƒªãƒ—ãƒ©ã‚¤ã®å†…å®¹
							$reply = 'æ®‹å¿µã€æœ¬ç”°åœ­ä½‘ã®å‹åˆ©ï¼'."\n\n"
									.'YOU LOSE!!!! ä¿ºã®å‹ã¡ï¼ğŸ˜ğŸ˜'."\n"
									.'è² ã‘ã¯æ¬¡ã«ç¹‹ãŒã‚‹ãƒãƒ£ãƒ³ã‚¹ã§ã™ã€‚ãƒãƒãƒ¼ã‚®ãƒ–ã‚¢ãƒƒãƒ—ï¼'."\n"
									.'ã»ãªã€ã„ãŸã ãã¾ã™(ï¾Œï¾Ÿï½¼ï½­ï½³ï½³ï½³ï½³ï½³ï½³ï½³)'."\n\n"
									.'ä¸€æ—¥ä½•å›ã§ã‚‚å‹è² ã€‚'."\n"
									.'ã˜ã‚ƒã‚ã€ã¾ãŸä»Šåº¦ğŸ‘‹â˜ºï¸'."\n";

							break;

						// è²·ã£ãŸå ´åˆ
						case 'YOU WIN':

							echo '    #æœ¬ç”°ã«ã‚°ãƒ¼ã§å‹ã¤ï¼šãŠè¦‹äº‹ï¼ã‚ãªãŸã®å‹åˆ©ï¼'."\n\n";

							// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‹•ç”»
							$video = dirname(__FILE__).'/video/honda_win_2.mp4';

							// ãƒªãƒ—ãƒ©ã‚¤ã®å†…å®¹
							$reply = 'ãŠè¦‹äº‹ï¼ã‚ãªãŸã®å‹åˆ©ï¼'."\n\n"
									.'YOU WIN!!!! ã‚„ã‚‹ã‚„ã‚“ã€‚'."\n"
									.'æ˜æ—¥ã¯ä¿ºã«ãƒªãƒ™ãƒ³ã‚¸ã•ã›ã¦ã€‚'."\n"
									.'ã§ã¯ã€ã©ã†ã(ï¾Œï¾Ÿï½¼ï½­ï½³ï½³ï½³ï½³ï½³ï½³ï½³)'."\n\n"
									.'ä¸€æ—¥ä½•å›ã§ã‚‚å‹è² ã€‚'."\n"
									.'ã˜ã‚ƒã‚ã€ã¾ãŸä»Šåº¦ğŸ‘‹â˜ºï¸'."\n";

							break;
					}
				}

				// å–å¾—ã—ãŸãƒ„ã‚¤ãƒ¼ãƒˆã« #æœ¬ç”°ã«ãƒãƒ§ã‚­ã§å‹ã¤ ãŒå«ã¾ã‚Œã¦ã„ãŸã‚‰
				if (strpos($res[$i]->text, 'ãƒãƒ§ã‚­') !== false){

					// å‹æ•—åˆ¤å®š
					switch($jyanken) {

						// è² ã‘ãŸå ´åˆ
						case 'YOU LOSE':

							echo '    #æœ¬ç”°ã«ãƒãƒ§ã‚­ã§å‹ã¤ï¼šæ®‹å¿µã€æœ¬ç”°åœ­ä½‘ã®å‹åˆ©ï¼'."\n\n";

							// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‹•ç”»
							$video = dirname(__FILE__).'/video/honda_lost_1.mp4';

							// ãƒªãƒ—ãƒ©ã‚¤ã®å†…å®¹
							$reply = 'æ®‹å¿µã€æœ¬ç”°åœ­ä½‘ã®å‹åˆ©ï¼'."\n\n"
									.'YOU LOSE!!!! ä¿ºã®å‹ã¡ï¼ğŸ˜'."\n"
									.'ãŸã‹ãŒã˜ã‚ƒã‚“ã‘ã‚“ã€ãã†æ€ã£ã¦ãªã„ã§ã™ã‹ï¼Ÿ'."\n"
									.'ãã‚Œã‚„ã£ãŸã‚‰æ˜æ—¥ã‚‚ã€ä¿ºãŒå‹ã¡ã¾ã™ã‚ˆã€‚'."\n"
									.'ã»ãªã€ã„ãŸã ãã¾ã™(ï¾Œï¾Ÿï½¼ï½­ï½³ï½³ï½³ï½³ï½³ï½³ï½³)'."\n\n"
									.'ä¸€æ—¥ä½•å›ã§ã‚‚å‹è² ã€‚'."\n"
									.'ã˜ã‚ƒã‚ã€ã¾ãŸä»Šåº¦ğŸ‘‹â˜ºï¸'."\n";

							break;

						// è²·ã£ãŸå ´åˆ
						case 'YOU WIN':

							echo '    #æœ¬ç”°ã«ãƒãƒ§ã‚­ã§å‹ã¤ï¼šãŠè¦‹äº‹ï¼ã‚ãªãŸã®å‹åˆ©ï¼'."\n\n";

							// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‹•ç”»
							$video = dirname(__FILE__).'/video/honda_win_3.mp4';

							// ãƒªãƒ—ãƒ©ã‚¤ã®å†…å®¹
							$reply = 'ãŠè¦‹äº‹ï¼ã‚ãªãŸã®å‹åˆ©ï¼'."\n\n"
									.'YOU WIN!!!! ã‚„ã‚‹ã‚„ã‚“ã€‚'."\n"
									.'æ˜æ—¥ã¯ä¿ºã«ãƒªãƒ™ãƒ³ã‚¸ã•ã›ã¦ã€‚'."\n"
									.'ã§ã¯ã€ã©ã†ã(ï¾Œï¾Ÿï½¼ï½­ï½³ï½³ï½³ï½³ï½³ï½³ï½³)'."\n\n"
									.'ä¸€æ—¥ä½•å›ã§ã‚‚å‹è² ã€‚'."\n"
									.'ã˜ã‚ƒã‚ã€ã¾ãŸä»Šåº¦ğŸ‘‹â˜ºï¸'."\n";

							break;
					}
				}

				// å–å¾—ã—ãŸãƒ„ã‚¤ãƒ¼ãƒˆã« #æœ¬ç”°ã«ãƒ‘ãƒ¼ã§å‹ã¤ ãŒå«ã¾ã‚Œã¦ã„ãŸã‚‰
				if (strpos($res[$i]->text, 'ãƒ‘ãƒ¼') !== false){

					// å‹æ•—åˆ¤å®š
					switch($jyanken) {

						// è² ã‘ãŸå ´åˆ
						case 'YOU LOSE':

							echo '    #æœ¬ç”°ã«ãƒ‘ãƒ¼ã§å‹ã¤ï¼šæ®‹å¿µã€æœ¬ç”°åœ­ä½‘ã®å‹åˆ©ï¼'."\n\n";

							// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‹•ç”»
							$video = dirname(__FILE__).'/video/honda_lost_2.mp4';

							// ãƒªãƒ—ãƒ©ã‚¤ã®å†…å®¹
							$reply = 'æ®‹å¿µã€æœ¬ç”°åœ­ä½‘ã®å‹åˆ©ï¼'."\n\n"
									.'YOU LOSE!!!! ä¿ºã®å‹ã¡ï¼ğŸ˜'."\n"
									.'ä½•ã§è² ã‘ãŸã‹æ˜æ—¥ã¾ã§ã«è€ƒãˆã¨ã„ã¦ãã ã•ã„ã€‚ãã—ãŸã‚‰ä½•ã‹ãŒè¦‹ãˆã¦ãã‚‹ã¯ãšã§ã™ã€‚'."\n"
									.'ã»ãªã€ã„ãŸã ãã¾ã™(ï¾Œï¾Ÿï½¼ï½­ï½³ï½³ï½³ï½³ï½³ï½³ï½³)'."\n\n"
									.'ä¸€æ—¥ä½•å›ã§ã‚‚å‹è² ã€‚'."\n"
									.'ã˜ã‚ƒã‚ã€ã¾ãŸä»Šåº¦ğŸ‘‹â˜ºï¸'."\n";

							break;

						// è²·ã£ãŸå ´åˆ
						case 'YOU WIN':

							echo '    #æœ¬ç”°ã«ãƒ‘ãƒ¼ã§å‹ã¤ï¼šãŠè¦‹äº‹ï¼ã‚ãªãŸã®å‹åˆ©ï¼'."\n\n";

							// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‹•ç”»
							$video = dirname(__FILE__).'/video/honda_win_1.mp4';

							// ãƒªãƒ—ãƒ©ã‚¤ã®å†…å®¹
							$reply = 'ãŠè¦‹äº‹ï¼ã‚ãªãŸã®å‹åˆ©ï¼'."\n\n"
									.'YOU WIN!!!! ã‚„ã‚‹ã‚„ã‚“ã€‚'."\n"
									.'æ˜æ—¥ã¯ä¿ºã«ãƒªãƒ™ãƒ³ã‚¸ã•ã›ã¦ã€‚'."\n"
									.'ã§ã¯ã€ã©ã†ã(ï¾Œï¾Ÿï½¼ï½­ï½³ï½³ï½³ï½³ï½³ï½³ï½³)'."\n\n"
									.'ä¸€æ—¥ä½•å›ã§ã‚‚å‹è² ã€‚'."\n"
									.'ã˜ã‚ƒã‚ã€ã¾ãŸä»Šåº¦ğŸ‘‹â˜ºï¸'."\n";

							break;
					}
				}

				
				// å–å¾—ã—ãŸãƒ„ã‚¤ãƒ¼ãƒˆã« #ç§ã¯æœ¬ç”°ã®Aã‚’å¼•ã ãŒå«ã¾ã‚Œã¦ã„ãŸã‚‰
				if (strpos($res[$i]->text, 'Aã‚’å¼•ã') !== false){

					// å‹æ•—åˆ¤å®š
					switch($jyanken) {

						case 'YOU LOSE':

							// ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã§é¸ã¶
							$you_lose = rand(1, 4); // 1ï½4ã®ä¹±æ•°ã‚’å–å¾—

							echo '    #ç§ã¯æœ¬ç”°ã®Aã‚’å¼•ãï¼šæ®‹å¿µã€æœ¬ç”°åœ­ä½‘ã®å‹åˆ©ï¼'."\n\n";

							// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‹•ç”»
							$video = dirname(__FILE__).'/video/honda_card_lost_A'.$you_lose.'.mp4';

							// ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã£ã¦æ–‡è¨€ã‚’å¤‰ãˆã‚‹
							switch($you_lose) {

								case 1:

									// ãƒªãƒ—ãƒ©ã‚¤ã®å†…å®¹
									$reply = 'æ®‹å¿µã€æœ¬ç”°åœ­ä½‘ã®å‹åˆ©ï¼'."\n\n"
											.'YOU LOSE!!!! ä¿ºã®å‹ã¡ï¼ğŸ˜'."\n"
											.'ã‚«ãƒ¼ãƒ‰ã®å‘ã“ã†å´ã«ä½•ãŒã‚ã‚‹ã‹ã€è€ƒãˆã¦ã¿ã¦ãã ã•ã„ã€‚'."\n"
											.'ã»ãªã€ã„ãŸã ãã¾ã™(ï¾Œï¾Ÿï½¼ï½­ï½³ï½³ï½³ï½³ï½³ï½³ï½³)'."\n\n"
											.'(ï½¯ï¾Šï½°)ã†ã¾ã„ï¼1æ—¥ä½•å›ã§ã‚‚å‹è² ã€‚'."\n"
											.'ã¾ãŸä»Šåº¦ğŸ‘‹â˜ºï¸'."\n";

									break;

								case 2:

									// ãƒªãƒ—ãƒ©ã‚¤ã®å†…å®¹
									$reply = 'æ®‹å¿µã€æœ¬ç”°åœ­ä½‘ã®å‹åˆ©ï¼'."\n\n"
											.'YOU LOSE!!!! ä¿ºã®å‹ã¡ï¼ğŸ˜'."\n"
											.'ã‚±ã‚¤ã‚¹ã‚± ãƒ›ãƒ³ãƒ€ã®å¿ƒãªã‚“ã¦èª­ã‚ã‚‹ã‚ã‘ãªã„ã€ãã†æ€ã£ã¦ãªã„ã§ã™ã‹ï¼Ÿ'."\n"
											.'ã‚ãã‚‰ã‚ã¸ã‚“äººã ã‘ã«è¦‹ãˆã‚‹æ™¯è‰²ãŒã‚ã‚‹ã¯ãšã§ã™ã€‚'."\n"
											.'ã»ãªã€ã„ãŸã ãã¾ã™(ï¾Œï¾Ÿï½¼ï½­ï½³ï½³ï½³ï½³ï½³ï½³ï½³)'."\n\n"
											.'(ï½¯ï¾Šï½°)ã†ã¾ã„ï¼1æ—¥ä½•å›ã§ã‚‚å‹è² ã€‚'."\n"
											.'ã¾ãŸä»Šåº¦ğŸ‘‹â˜ºï¸'."\n";

									break;

								case 3:

									// ãƒªãƒ—ãƒ©ã‚¤ã®å†…å®¹
									$reply = 'æ®‹å¿µã€æœ¬ç”°åœ­ä½‘ã®å‹åˆ©ï¼'."\n\n"
											.'YOU LOSE!!!! ä¿ºã®å‹ã¡ï¼ğŸ˜'."\n"
											.'ã‚¦ãƒ©ã®ã‚¦ãƒ©ã®ã‚¦ãƒ©ã¾ã§ã€èª­ã‚€è¨“ç·´ã‚’ã—ã¦ãã ã•ã„ã­ã€‚'."\n"
											.'ã©ã“ã¾ã§èª­ã‚‚ã†ã¨ã™ã‚‹ã‹ã§ã€çµæœãŒå¤‰ã‚ã£ã¦ãã¾ã™ã€‚'."\n"
											.'ã»ãªã€ã„ãŸã ãã¾ã™(ï¾Œï¾Ÿï½¼ï½­ï½³ï½³ï½³ï½³ï½³ï½³ï½³)'."\n\n"
											.'(ï½¯ï¾Šï½°)ã†ã¾ã„ï¼1æ—¥ä½•å›ã§ã‚‚å‹è² ã€‚'."\n"
											.'ã¾ãŸä»Šåº¦ğŸ‘‹â˜ºï¸'."\n";

									break;

								case 4:

									// ãƒªãƒ—ãƒ©ã‚¤ã®å†…å®¹
									$reply = 'æ®‹å¿µã€æœ¬ç”°åœ­ä½‘ã®å‹åˆ©ï¼'."\n\n"
											.'YOU LOSE!!!! ä¿ºã®å‹ã¡ï¼ğŸ˜'."\n"
											.'ã‚¦ãƒ©ã®ã‚¦ãƒ©ã®ã‚¦ãƒ©ã¾ã§ã€èª­ã‚€è¨“ç·´ã‚’ã—ã¦ãã ã„ã­ã€‚'."\n"
											.'ã©ã“ã¾ã§èª­ã‚‚ã†ã¨ã™ã‚‹ã‹ã§ã€çµæœãŒå¤‰ã‚ã£ã¦ãã¾ã™ã€‚'."\n"
											.'ã»ãªã€ã„ãŸã ãã¾ã™(ï¾Œï¾Ÿï½¼ï½­ï½³ï½³ï½³ï½³ï½³ï½³ï½³)'."\n\n"
											.'(ï½¯ï¾Šï½°)ã†ã¾ã„ï¼1æ—¥ä½•å›ã§ã‚‚å‹è² ã€‚'."\n"
											.'ã¾ãŸä»Šåº¦ğŸ‘‹â˜ºï¸'."\n";

									break;
							}

							break;

						case 'YOU WIN':

							echo '    #ç§ã¯æœ¬ç”°ã®Aã‚’å¼•ãï¼šãŠè¦‹äº‹ï¼ã‚ãªãŸã®å‹åˆ©ï¼'."\n\n";

							// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‹•ç”»
							$video = dirname(__FILE__).'/video/honda_card_win_A.mp4';

							// ãƒªãƒ—ãƒ©ã‚¤ã®å†…å®¹
							$reply = 'ãŠè¦‹äº‹ï¼ã‚ãªãŸã®å‹åˆ©ï¼'."\n\n"
									.'YOU WIN!!!! ä¿ºã®è² ã‘ï¼'."\n"
									.'ã‚„ã‚‹ã‚„ã‚“ï¼'."\n"
									.'ã§ã‚‚ã€ä»Šåº¦ã¯çµ¶å¯¾ã€ä¿ºãŒå‹ã¤ã‹ã‚‰ï¼'."\n"
									.'ã¾ãŸæ˜æ—¥ã‚„ã‚ã†ï¼(ï¾Œï¾Ÿï½¼ï½­ï½³ï½³ï½³ï½³ï½³ï½³ï½³)'."\n\n"
									.'(ï½¯ï¾Šï½°)ã†ã¾ã„ï¼1æ—¥ä½•å›ã§ã‚‚å‹è² ã€‚'."\n"
									.'ã¾ãŸä»Šåº¦ğŸ‘‹â˜ºï¸'."\n";

							break;
					}
				}

				// å–å¾—ã—ãŸãƒ„ã‚¤ãƒ¼ãƒˆã« #ç§ã¯æœ¬ç”°ã®Bã‚’å¼•ã ãŒå«ã¾ã‚Œã¦ã„ãŸã‚‰
				if (strpos($res[$i]->text, 'Bã‚’å¼•ã') !== false){

					// å‹æ•—åˆ¤å®š
					switch($jyanken) {

						case 'YOU LOSE':

							// ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã§é¸ã¶
							$you_lose = rand(1, 3); // 1ï½3ã®ä¹±æ•°ã‚’å–å¾—

							echo '    #ç§ã¯æœ¬ç”°ã®Bã‚’å¼•ãï¼šæ®‹å¿µã€æœ¬ç”°åœ­ä½‘ã®å‹åˆ©ï¼'."\n\n";

							// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‹•ç”»
							$video = dirname(__FILE__).'/video/honda_card_lost_B'.$you_lose.'.mp4';

							// ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã£ã¦æ–‡è¨€ã‚’å¤‰ãˆã‚‹
							switch($you_lose) {

								case 1:

									// ãƒªãƒ—ãƒ©ã‚¤ã®å†…å®¹
									$reply = 'æ®‹å¿µã€æœ¬ç”°åœ­ä½‘ã®å‹åˆ©ï¼'."\n\n"
											.'YOU LOSE!!!! ä¿ºã®å‹ã¡ï¼ğŸ˜'."\n"
											.'ã©ã‚“ãªäº‹ã§ã‚‚ã€çµ¶å¯¾ã«å‹ã¤ã‚“ã‚„ï¼ã¨ã„ã†ãƒ¡ãƒ³ã‚¿ãƒªãƒ†ã‚£ãƒ¼ãŒå¤§äº‹ã§ã™ã‚ˆã€‚'."\n"
											.'ã»ãªã€ã„ãŸã ãã¾ã™(ï¾Œï¾Ÿï½¼ï½­ï½³ï½³ï½³ï½³ï½³ï½³ï½³)'."\n\n"
											.'(ï½¯ï¾Šï½°)ã†ã¾ã„ï¼1æ—¥ä½•å›ã§ã‚‚å‹è² ã€‚'."\n"
											.'ã¾ãŸä»Šåº¦ğŸ‘‹â˜ºï¸'."\n";

									break;

								case 2:

									// ãƒªãƒ—ãƒ©ã‚¤ã®å†…å®¹
									$reply = 'æ®‹å¿µã€æœ¬ç”°åœ­ä½‘ã®å‹åˆ©ï¼'."\n\n"
											.'YOU LOSE!!!! ä¿ºã®å‹ã¡ï¼ğŸ˜'."\n"
											.'è‡ªä¿¡ã‚’æŒã£ã¦ã€å‹è² ã«ã—ã£ã‹ã‚Šã¨å‘ãåˆãˆã‚‹ã€‚'."\n"
											.'ãã†æ€ãˆã‚‹ã¾ã§ã€æº–å‚™ã—ã¦ãã ã•ã„ã€‚'."\n"
											.'ã»ãªã€ã„ãŸã ãã¾ã™(ï¾Œï¾Ÿï½¼ï½­ï½³ï½³ï½³ï½³ï½³ï½³ï½³)'."\n\n"
											.'(ï½¯ï¾Šï½°)ã†ã¾ã„ï¼1æ—¥ä½•å›ã§ã‚‚å‹è² ã€‚'."\n"
											.'ã¾ãŸä»Šåº¦ğŸ‘‹â˜ºï¸'."\n";

									break;

								case 3:

									// ãƒªãƒ—ãƒ©ã‚¤ã®å†…å®¹
									$reply = 'æ®‹å¿µã€æœ¬ç”°åœ­ä½‘ã®å‹åˆ©ï¼'."\n\n"
											.'YOU LOSE!!!! ä¿ºã®å‹ã¡ï¼ğŸ˜'."\n"
											.'è¤‡é›‘ã«è€ƒãˆã¦ãªã„ã§ã™ã‹ï¼Ÿç­”ãˆã¯ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚'."\n"
											.'ã‚±ã‚¤ã‚¹ã‚± ãƒ›ãƒ³ãƒ€ã®å¿ƒã‚’èª­ã‚€ã€ãã‚Œã ã‘ã§ã™ã€‚'."\n"
											.'ã»ãªã€ã„ãŸã ãã¾ã™(ï¾Œï¾Ÿï½¼ï½­ï½³ï½³ï½³ï½³ï½³ï½³ï½³)'."\n\n"
											.'(ï½¯ï¾Šï½°)ã†ã¾ã„ï¼1æ—¥ä½•å›ã§ã‚‚å‹è² ã€‚'."\n"
											.'ã¾ãŸä»Šåº¦ğŸ‘‹â˜ºï¸'."\n";

									break;
							}

							break;

						case 'YOU WIN':

							echo '    #ç§ã¯æœ¬ç”°ã®Bã‚’å¼•ãï¼šãŠè¦‹äº‹ï¼ã‚ãªãŸã®å‹åˆ©ï¼'."\n\n";

							// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‹•ç”»
							$video = dirname(__FILE__).'/video/honda_card_win_B.mp4';

							// ãƒªãƒ—ãƒ©ã‚¤ã®å†…å®¹
							$reply = 'ãŠè¦‹äº‹ï¼ã‚ãªãŸã®å‹åˆ©ï¼'."\n\n"
									.'YOU WIN!!!! ä¿ºã®è² ã‘ï¼'."\n"
									.'ã‚„ã‚‹ã‚„ã‚“ï¼'."\n"
									.'ã§ã‚‚ã€ä»Šåº¦ã¯çµ¶å¯¾ã€ä¿ºãŒå‹ã¤ã‹ã‚‰ï¼'."\n"
									.'ã¾ãŸæ˜æ—¥ã‚„ã‚ã†ï¼(ï¾Œï¾Ÿï½¼ï½­ï½³ï½³ï½³ï½³ï½³ï½³ï½³)'."\n\n"
									.'(ï½¯ï¾Šï½°)ã†ã¾ã„ï¼1æ—¥ä½•å›ã§ã‚‚å‹è² ã€‚'."\n"
									.'ã¾ãŸä»Šåº¦ğŸ‘‹â˜ºï¸'."\n";

							break;
					}
				}

				// video ãŒ NULL ã§ãªã„ãªã‚‰
				if (isset($video)){

					// Twitterã«å‹•ç”»ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
					$media = $connection->upload('media/upload', ['media' => $video, 'media_type' => 'video/mp4'], true);

					// #æœ¬ç”°å„ªã—ãã—ã¦ ã‹ #æœ¬ç”°å¤§å¥½ã ãŒå…¥ã£ã¦ã„ãŸã‚‰
					if ($percent == 40 or $percent == 70){

						switch($jyanken) {

							case 'YOU LOSE':
								$reply = str_replace('YOU LOSE!!!!', 'ã¾ã ã¾ã ç”˜ã„ã§ã™ã€‚YOU LOSE!!!!', $reply);
								break;

							case 'YOU WIN':
								$reply = str_replace('YOU WIN!!!!', 'å‹ã¦ã¦ã‚ˆã‹ã£ãŸãªã€‚YOU WIN!!!!', $reply);
								break;

						}
					}
					
					$reply_array = array(
						'status' => '@'.$res[$i]->user->screen_name."\n".$reply,
						'media_ids' => implode(',', [$media->media_id_string]),
						'in_reply_to_status_id' => $res[$i]->id,
					);

				// æœ‰åŠ¹ãªã‚³ãƒãƒ³ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ãªã‹ã£ãŸã¨ãã¯ãƒ˜ãƒ«ãƒ—ã‚’é€ä¿¡ã™ã‚‹
				} else if (strpos($res[$i]->text, 'ã˜ã‚ƒã‚ã€ã¾ãŸä»Šåº¦') === false){

					echo '    ã‚³ãƒãƒ³ãƒ‰ãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ãƒ˜ãƒ«ãƒ—ã‚’é€ä¿¡ã—ã¾ã™ã€‚'."\n\n";

					// ãƒªãƒ—ãƒ©ã‚¤ã®å†…å®¹
					$reply = 'ã‚³ãƒãƒ³ãƒ‰ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚'."\n\n"
							.'ã˜ã‚ƒã‚“ã‘ã‚“ã™ã‚‹ãªã‚‰ã€Œ@HondaJyanken #æœ¬ç”°ã«(ã‚°ãƒ¼ or ãƒãƒ§ã‚­ or ãƒ‘ãƒ¼)ã§å‹ã¤ã€ã¨ãƒ„ã‚¤ãƒ¼ãƒˆã€'."\n"
							.'ã‚«ãƒ¼ãƒ‰ãƒãƒˆãƒ«ã™ã‚‹ãªã‚‰ã€Œ@HondaJyanken #ç§ã¯æœ¬ç”°ã®(A or B)ã‚’å¼•ãã€ã¨ãƒ„ã‚¤ãƒ¼ãƒˆã—ã¨ã„ã¦ãã ã•ã„ã€‚'."\n\n"
							.'1æ—¥ä½•å›ã§ã‚‚å‹è² ã€‚'."\n"
							.'ã˜ã‚ƒã‚ã€ã‚‚ã†ä¸€åº¦ğŸ‘‹â˜ºï¸'."\n";
					
					$reply_array = array(
						'status' => '@'.$res[$i]->user->screen_name."\n".$reply,
						'in_reply_to_status_id' => $res[$i]->id,
					);

				}

				// ãƒªãƒ—ãƒ©ã‚¤ã‚’é€ã‚‹
				$rp = $connection->post('statuses/update', $reply_array);
				
				// ãƒ•ã‚¡ãƒœã‚‹
				$fav = $connection->post('favorites/create', array('id' => $res[$i]->id));

				// é€ä¿¡çµæœ
				$result = $connection->get('account/verify_credentials');

				// ã‚¨ãƒ©ãƒ¼ç¢ºèª
				if ($rp and !isset($info->errors)){
					echo '    '.($i+1).'ç•ªç›®ã®ãƒ„ã‚¤ãƒ¼ãƒˆ: çµæœã‚’ãƒ„ã‚¤ãƒ¼ãƒˆã—ã¾ã—ãŸã€‚'."\n\n";
				} else {
					echo '    '.($i+1).'ç•ªç›®ã®ãƒ„ã‚¤ãƒ¼ãƒˆ: çµæœã®ãƒ„ã‚¤ãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸâ€¦'."\n\n";
				}

				// ãƒ˜ãƒ«ãƒ—ã‚’ç¶šã‘ã¦é€ä¿¡ã™ã‚‹
				if (!isset($video)){
					
					// ãƒªãƒ—ãƒ©ã‚¤ã®å†…å®¹
					$reply = 'å‹ç‡ã¯æœ¬å®¶ã‚ˆã‚Šã‚‚é«˜ã‚ã®10%ã§ã™ãŒã€ãƒ„ã‚¤ãƒ¼ãƒˆã« #æœ¬ç”°å„ªã—ãã—ã¦ ã¨ã¤ã‘ã‚‹ã¨å‹ç‡ãŒ40%ã«ã€#æœ¬ç”°å¤§å¥½ã ã¨ã¤ã‘ã‚‹ã¨å‹ç‡ãŒ70%ã«ä¸ŠãŒã‚Šã¾ã™ã€‚'."\n\n"
							.'ã©ã†ã—ã¦ã‚‚å‹ã¦ãªã„æ™‚ã€è©¦ã—ã¨ã„ã¦ãã ã•ã„ã€‚'."\n"
							.'ã»ãªã€ï¼ˆå‹åˆ©ï¼‰ã„ãŸã ãã¾ã™ğŸ˜'."\n\n";
					
					$reply_array = array(
						'status' => $reply,
						'in_reply_to_status_id' => $rp->id,
					);

					// ãƒªãƒ—ãƒ©ã‚¤ã‚’é€ã‚‹
					$rp = $connection->post('statuses/update', $reply_array);

				}

			} else if ($res[$i]->user->screen_name == $screen_name){

				echo '    '.($i+1).'ç•ªç›®ã®ãƒ„ã‚¤ãƒ¼ãƒˆ: è‡ªåˆ†ã‹ã‚‰ã®ãƒªãƒ—ãƒ©ã‚¤ã®ãŸã‚ã€ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚'."\n\n";

			} else if ($tweet_timestamp < $last_timestamp){

				echo '    '.($i+1).'ç•ªç›®ã®ãƒ„ã‚¤ãƒ¼ãƒˆ: å‰å›ã®å®Ÿè¡Œæ™‚åˆ»ã‚ˆã‚Šã‚‚å‰ã«ãƒ„ã‚¤ãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚'."\n\n";

			}
	
			echo '  -------------------------------------------------------'."\n\n";
		}

		echo '    ãƒªãƒ—ãƒ©ã‚¤ã‚’çµ‚äº†ã—ã¾ã™ã€‚'."\n\n";
		echo '    å®Ÿè¡Œã‚’å®Œäº†ã—ã¾ã—ãŸã€‚çµ‚äº†ã—ã¾ã™ã€‚'."\n\n";
		echo '  -------------------------------------------------------'."\n\n";

	} else { //ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒãªã„å ´åˆ
		echo 'ãƒ„ã‚¤ãƒ¼ãƒˆã•ã›ã‚‹ã«ã¯ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚';
	}

